* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v2.0 on Nov, 03. 2017. JOBID=1509728524
* REFINES WATER MOLECULES OUT OF THE PORE REGION
* 

DIMENS CHSIZE 3000000 MAXRES 3000000

! Read topology and parameter files
stream toppar.str

!Read the system information
stream step3_size.str

!Read Protein & Water
stream step2.1_pore.str

open read card unit 10 name step2.1_porewat.crd
read coor card unit 10 append

!delete atom sele .byres. ( type OH2 .and. resid @resid ) end

coor stat sele type OH2 end
set nwater ?nsel

IF BOXTYPE .eq. HEXA THEN
   calc A = @A / cos ( 30.0 * ?pi / 180.0 )
   calc B = @B / cos ( 30.0 * ?pi / 180.0 )
ENDIF

COOR CONVERT ALIGNED SYMMETRIC @A @B @C @alpha @beta @gamma

open write card unit 10 name step4.4_pore.pdb
write coor pdb  unit 10 
* Equilibrated water 
*

open write unit 10 card name step4.4_pore.crd
write coor unit 10 card
* Equilibrated water 
*

open write unit 10 card name step4.4_pore.str
write title unit 10
* read sequence TIP3 @nwater
* generate PWAT setup noangle nodihedral
*

delete atom

! Read PSF
open read unit 10 card name step1_pdbreader.psf
read psf  unit 10 card
 
! Read COOR
open read unit 10 card name step2_orient.crd
read coor unit 10 card

stream step4.4_pore.str

open read card unit 10 name step4.4_pore.crd
read coor unit 10 card append

open write card unit 10 name step2.1_pore_refined.pdb
write coor pdb  unit 10 

stop